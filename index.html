<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rs 10 Lucky Draw</title>
<style>
body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:radial-gradient(circle at top,#1a2a3a,#0b141e 70%);color:#fff;}
header{padding:30px;text-align:center;}
header h1{color:#ffd700;font-size:2.5rem;margin-bottom:5px;}
header p{opacity:.8;font-size:1rem;}
.container{max-width:900px;margin:auto;padding:20px;}
.card{background:rgba(255,255,255,0.05);padding:25px;border-radius:20px;margin-bottom:25px;box-shadow:0 10px 30px rgba(0,0,0,0.5);}
input,button{padding:12px;border-radius:12px;border:none;font-size:1rem;}
input{width:100%;margin-bottom:10px;}
button{cursor:pointer;background:linear-gradient(135deg,#ffd700,#ffea00);color:#000;font-weight:bold;}
button:hover{opacity:.9}
.total{text-align:center;color:#00ffd5;font-weight:600;margin-bottom:10px;}
.ticket-box{margin-top:15px;background:linear-gradient(135deg,#ffd700,#ffb700);padding:15px;border-radius:15px;display:none;}
.ticket-box h3{margin:5px 0;}
.whatsapp{display:inline-block;margin-top:10px;padding:10px 18px;background:#25D366;color:#fff;text-decoration:none;border-radius:10px;font-weight:600;}
footer{text-align:center;padding:20px;font-size:0.9rem;opacity:0.8;}
</style>
</head>
<body>
<header>
<h1>üéü Rs 10 Lucky Draw</h1>
<p>Request tickets, upload payment screenshot, admin confirms, and get your tickets!</p>
</header>

<div class="container">
  <!-- Request Tickets -->
  <div class="card">
    <h2>Request Tickets</h2>
    <input id="name" type="text" placeholder="Full Name">
    <input id="phone" type="tel" placeholder="WhatsApp Number">
    <input id="tickets" type="number" placeholder="Number of Tickets" min="1">
    <div class="total" id="total">Total: Rs 0</div>
    <input type="file" id="paymentScreenshot" accept="image/*">
    <button id="requestBtn">Request Tickets</button>
    <p id="statusMsg" style="color:#00ffd5;font-weight:600;"></p>
    <div class="ticket-box" id="ticketBox">
      <h3>Your Tickets</h3>
      <p><strong>Name:</strong> <span id="tName"></span></p>
      <p><strong>WhatsApp:</strong> <span id="tPhone"></span></p>
      <p><strong>Tickets:</strong> <span id="tIds"></span></p>
      <a class="whatsapp" href="https://wa.me/923278568763" target="_blank">Contact Organizer</a>
    </div>
  </div>

  <!-- Check Tickets -->
  <div class="card">
    <h2>Check Tickets</h2>
    <input id="checkPhone" type="tel" placeholder="Enter WhatsApp Number">
    <button id="checkBtn">Check</button>
    <div class="ticket-box" id="checkResults" style="display:none;"></div>
  </div>
</div>

<footer>¬© 2025 Lucky Draw. All Rights Reserved.</footer>

<script>
// Calculate total
const ticketsInput = document.getElementById('tickets');
const totalDisplay = document.getElementById('total');
ticketsInput.addEventListener('input',()=>{
  const val = Number(ticketsInput.value)||0;
  totalDisplay.textContent='Total: Rs '+(val*10);
});

// GitHub repo details
const repoOwner = 'YOUR_GITHUB_USERNAME';
const repoName = 'YOUR_REPO_NAME';
const filePath = 'entries.json';
const branch = 'main';
const githubToken = 'YOUR_PERSONAL_ACCESS_TOKEN'; // ‚ö†Ô∏è Sensitive! Avoid exposing in public HTML

// Helper: Generate random tickets
function generateTickets(count){
  let arr=[];
  for(let i=0;i<count;i++) arr.push('T'+Math.floor(100000+Math.random()*900000));
  return arr;
}

// Request tickets (user uploads screenshot)
document.getElementById('requestBtn').addEventListener('click', async()=>{
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const count = Number(document.getElementById('tickets').value);
  const screenshot = document.getElementById('paymentScreenshot').files[0];

  if(!name || !phone || !count || !screenshot){
    alert('Please enter all fields and upload screenshot');
    return;
  }

  document.getElementById('statusMsg').textContent='Request sent. Wait for admin confirmation.';

  // Fetch current entries.json
  let entriesRes = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`);
  let entriesData = await entriesRes.json();
  const sha = entriesData.sha;
  const content = JSON.parse(atob(entriesData.content));

  // Add new request
  if(!content[phone]) content[phone]={name:name,tickets:[],paid:false};
  content[phone].requestedTickets = count;
  content[phone].paymentScreenshot = screenshot.name;

  // Update GitHub via API
  await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`,{
    method:'PUT',
    headers:{
      'Authorization':'token '+githubToken,
      'Content-Type':'application/json'
    },
    body:JSON.stringify({
      message:`User ${phone} requested tickets`,
      content:btoa(JSON.stringify(content,null,2)),
      sha:sha,
      branch:branch
    })
  });

  alert('Request sent successfully.');
});

// Check tickets after admin confirms payment
document.getElementById('checkBtn').addEventListener('click', async()=>{
  const phone = document.getElementById('checkPhone').value.trim();
  if(!phone){ alert('Enter number'); return; }

  const resultBox = document.getElementById('checkResults');

  // Fetch entries.json
  let entriesRes = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`);
  let entriesData = await entriesRes.json();
  const content = JSON.parse(atob(entriesData.content));

  if(content[phone] && content[phone].paid){
    // Generate tickets if not already
    if(content[phone].tickets.length === 0 && content[phone].requestedTickets){
      content[phone].tickets = generateTickets(content[phone].requestedTickets);
      content[phone].requestedTickets = 0;
      // ‚ö†Ô∏è Optionally, update GitHub again here
    }
    resultBox.innerHTML=`<h3>Tickets for ${content[phone].name}</h3><p>${content[phone].tickets.join(', ')}</p>`;
  }else{
    resultBox.innerHTML=`<p>Payment not confirmed or no tickets requested yet.</p>`;
  }
  resultBox.style.display='block';
});
</script>
</body>
</html>